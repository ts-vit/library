# Детальная выжимка по главам: RAG-системы (Р.В. Душкин)

Книга Романа Душкина представляет собой комплексное руководство по проектированию и внедрению систем генерации с дополненной выборкой (RAG). Ниже представлен подробный разбор каждой из 10 глав.

---

### Глава 1. Введение в RAG-системы
*   **Фундаментальная проблема:** LLM "заморожены" во времени, галлюцинируют (конфабуляция) и не обладают специфическими знаниями о внутренних процессах компании.
*   **Решение:** RAG разделяет хранение знаний и их обработку. Это "внешний жесткий диск" для ИИ.
*   **Эволюция поиска:** От простого лексического поиска (TF-IDF, BM25) через семантические векторы (Word2Vec, BERT) к RAG, который не просто ищет, но и рассуждает над найденным.

### Глава 2. Архитектура и компоненты
*   **Два потока:**
    1.  **Офлайн (Ingestion):** Загрузка → Чанкинг → Эмбеддинги → Векторная БД.
    2.  **Онлайн (Retrieval):** Вопрос → Поиск → Реранкинг → Обогащение промпта → Генерация ответа.
*   **Паттерны развития:** "Наивный" RAG (простой путь) → Продвинутый (реранкинг, гибрид) → Модульный (маршрутизация, память) → Агентный (автономное планирование).

### Глава 3. Векторные представления и эмбеддинги
*   **Семантическая геометрия:** Похожие смыслы располагаются рядом в многомерном пространстве (косинусное сходство).
*   **Ландшафт БД:** Сравнение Chroma (простота), Pinecone (облако), Qdrant (Rust/скорость), Milvus (Big Data) и pgvector (SQL).
*   **Искусство чанкинга:** 40–60% успеха RAG зависит от нарезки текста. Виды: фиксированный, скользящее окно, семантический (по смысловым разрывам), структурный (по тегам HTML/PDF).

### Глава 4. Фреймворки и инструменты
*   Разбор экосистемы: универсальные гиганты (**LangChain**, **LlamaIndex**) против узкоспециализированных решений. Выбор инструментов зависит от стадии проекта: от прототипа (MVP) до корпоративного "энтерпрайза".

### Глава 5. Ретриверы и поиск информации
*   **Гибридный поиск:** Объединение "смысла" (Dense) и "точных слов" (Sparse/BM25).
*   **Re-ranking:** Использование кросс-энкодеров для перепроверки топ-100 результатов. Это замедляет ответ, но критически повышает точность.
*   **BM42:** Новое поколение гибридных алгоритмов, интегрирующих векторы в формулу поиска.

### Глава 6. Типизация RAG-сервисов
*   **Классификация по целям:**
    *   *Разговорные:* Чат-боты техподдержки.
    *   *Аналитические:* Извлечение инсайтов из логов и отчетов.
    *   *Контентные:* Генерация статей и суммаризация.
    *   *Экспертные:* Поддержка принятия решений (медицина, право).

### Глава 7. Оценка эффективности
*   **Метрики поиска:** Hit Rate, MRR (Mean Reciprocal Rank), NDCG.
*   **Триада RAGAS:**
    1.  **Faithfulness:** Ответ подтвержден контекстом?
    2.  **Answer Relevance:** Ответ соответствует вопросу?
    3.  **Context Precision:** Насколько качественные чанки мы нашли?
*   **LLM-as-a-Judge:** Использование мощных моделей (GPT-4/Pro) для оценки работы более дешевых (Flash).

### Глава 8. Проблемы точности и галлюцинаций
*   **Проблема "Lost in the Middle":** Модели плохо помнят факты из середины длинного контекста.
*   **Гарды (Guardrails):** Многоуровневая защита (PII-фильтры, детекторы токсичности, валидаторы достоверности).
*   **Техники борьбы:** Цепочки рассуждений (CoT), самокритика (Self-reflection), голосование большинством (Self-Consistency).

### Глава 9. Память и контекст
*   **Виды памяти агента:**
    *   *Краткосрочная:* Текущая сессия.
    *   *Эпизодическая:* История всех диалогов.
    *   *Семантическая:* Накопленные факты.
    *   *Процедурная:* Навыки работы с инструментами.
*   **Ассоциативно-гетерархическая память:** Динамические связи между воспоминаниями без жесткой иерархии.

### Глава 10. Корпоративные решения
*   **Интеграция:** Связка RAG с ERP (SAP, 1C), CRM (Salesforce) и SharePoint.
*   **Безопасность:** Защита от отравления данных (data poisoning) и атак на извлечение знаний.
*   **Готовые платформы:** Azure AI Search, Amazon Bedrock, Сбер AI Platform, Yandex Cloud DataSphere.

### Глава 11. Специализированные применения
*   **Юридическая сфера:** Анализ договоров, поиск по нормативно-правовым актам и судебной практике.
*   **Медицина:** Поддержка принятия врачебных решений, работа с клиническими рекомендациями.
*   **Образование:** Персонализированные тьюторы и адаптивные системы обучения на базе знаний учебных курсов.

### Глава 12. Интеллектуальная поддержка клиентов
*   **Чат-боты нового поколения:** Переход от сценарных ботов к свободным диалогам на основе актуальных данных компании.
*   **Интеграция с CRM:** Использование контекста клиента для предоставления персонализированных ответов.
*   **Практика:** Полная реализация пайплайна поддержки (код чат-бота, конфиги и переменные окружения).

### Глава 13. RAG vs Fine-tuning
*   **Сравнение подходов:** Когда дообучать (Fine-tuning/LoRA), а когда подключать знания (RAG).
*   **Критерии выбора:** Стоимость, частота обновления данных, требования к точности фактов.
*   **Гибридные решения:** RAG-Tuned-LLM и совместная оптимизация компонентов для достижения максимального качества.

### Глава 14. Мультимодальные RAG-системы
*   **Визуальные данные:** Обработка PDF со сложной версткой, таблицами и изображениями через мультимодальные векторы.
*   **Видео и Аудио:** Индексация контента по сценам (SceneRAG) и транскриптам для поиска информации в медиафайлах.
*   **Слияние модальностей:** Унифицированное векторное пространство для кросс-модального поиска.

### Глава 15. Масштабирование и производительность
*   **Оптимизация:** Кеширование запросов, горизонтальное масштабирование векторных БД и управление латентностью в высоконагруженных системах.
*   **Архитектура:** Построение надежных продакшн-систем, способных обрабатывать тысячи запросов в секунду.

---
**Резюме:** Книга Душкина — это манифест перехода от "игрушечных" чат-ботов к надежным корпоративным системам управления знаниями. Полный охват тем от базового поиска до мультимодальных агентов и промышленного масштабирования.
